

<section class="signup-container">
  <header class="auth-card__head">
    <p class="eyebrow"><%= t('users.new.title') %></p>
  </header>
  <%= form_with url: signup_path, model: @user, local: true, html: { class: "stacked-form" } do |form| %>
    <div class="form-group">
      <%= form.label :username, t('users.new.form.username_label'), class: "form-label" %>
      <%= form.text_field :username, class: "form-control", id: "username", autocomplete: "username" %>
      <div id="username-validation" class="validation-message"><%= t('users.new.validation.username') %></div>
    </div>

    <div class="form-group">
      <%= form.label :email, t('users.new.form.email_label'), class: "form-label" %>
      <%= form.email_field :email, class: "form-control", id: "email", autocomplete: "email" %>
      <div id="email-validation" class="validation-message"><%= t('users.new.validation.email') %></div>
    </div>

    <div class="form-group">
      <%= form.label :password, t('users.new.form.password_label'), class: "form-label" %>
      <%= form.password_field :password, class: "form-control", id: "password", autocomplete: "new-password" %>
      <div id="password-validation" class="validation-message"><%= t('users.new.validation.password') %></div>
    </div>

    <div class="form-group">
      <%= form.label :password_confirmation, t('users.new.form.password_confirmation_label'), class: "form-label" %>
      <%= form.password_field :password_confirmation, class: "form-control", id: "password_confirmation", autocomplete: "new-password" %>
      <div id="password-confirm-validation" class="validation-message"><%= t('users.new.validation.password_confirmation') %></div>
    </div>

    <%= form.hidden_field :highest_rate, value: 2 %>

    <div class="form-group">
      <%= form.submit t('users.new.form.submit'), class: "submit-button" %>
    </div>
  <% end %>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const usernameInput = document.getElementById('username');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const passwordConfirmInput = document.getElementById('password_confirmation');

        usernameInput.addEventListener('input', validateUsername);
        emailInput.addEventListener('input', validateEmail);
        passwordInput.addEventListener('input', validatePassword);
        passwordConfirmInput.addEventListener('input', validatePasswordConfirm);

        function validateUsername() {
            const message = document.getElementById('username-validation');
            if (usernameInput.value.trim().length > 0) {
                message.classList.remove('invalid');
                message.classList.add('valid');
            } else {
                message.classList.remove('valid');
                message.classList.add('invalid');
            }
        }

        function validateEmail() {
            const message = document.getElementById('email-validation');
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (emailPattern.test(emailInput.value)) {
                message.classList.remove('invalid');
                message.classList.add('valid');
            } else {
                message.classList.remove('valid');
                message.classList.add('invalid');
            }
        }

        function validatePassword() {
            const message = document.getElementById('password-validation');
            if (passwordInput.value.length >= 1 && passwordInput.value.length <= 8) {
                message.classList.remove('invalid');
                message.classList.add('valid');
            } else {
                message.classList.remove('valid');
                message.classList.add('invalid');
            }
        }

        function validatePasswordConfirm() {
            const message = document.getElementById('password-confirm-validation');
            if (passwordInput.value === passwordConfirmInput.value) {
                message.classList.remove('invalid');
                message.classList.add('valid');
            } else {
                message.classList.remove('valid');
                message.classList.add('invalid');
            }
        }
    });
</script>
